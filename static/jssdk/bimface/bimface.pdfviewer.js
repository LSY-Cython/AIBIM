"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){function e(e,t){var n=[],i=!0,o=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){o=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),version="2021-4-29-15-48",Glodon=window.Glodon=window.Glodon||{};Glodon.Version=version,function(){function e(e,t){for(var n=t.split("."),i=e,o=n.length,a=0;a<o;a++)void 0===i[n[a]]&&(i[n[a]]={}),i=i[n[a]];return i}e(Glodon,"Web.Lang.Utility.Namespace").ensureNamespace=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Common"),t=function(e){"string"==typeof e&&(e=JSON.parse(res)),this.code=e.code,this.message=e.message};t.prototype={getErrorCode:function(){return this.code},getErrorMessage:function(){return this.message}},e.Error=t}();var Vector3=function(){function e(t,n,i){_classCallCheck(this,e),this.x=t||0,this.y=n||0,this.z=i||0}return _createClass(e,[{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}}]),e}(),Box3=function(){function e(t,n){_classCallCheck(this,e),this.min=t||new Vector3(1/0,1/0,1/0),this.max=n||new Vector3(-1/0,-1/0,-1/0)}return _createClass(e,[{key:"getSize",value:function(){return new Vector3(this.max.x-this.min.x,this.max.y-this.min.y,this.max.z-this.min.z)}},{key:"setFromCenterAndSize",value:function(e,t){var n=new Vector3(t.x,t.y).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"getCenter",value:function(){return new Vector3(this.min.x+this.max.x,this.min.y+this.max.y,this.min.z+this.max.z).multiplyScalar(.5)}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}}]),e}();!function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Algorithm"),t=function(){function e(t,n){_classCallCheck(this,e),this.points=t,this.searchRangeSquared=Math.pow(n,2),this.EPSILON_SQR=.1,this.clusters=[],this._clusterId=1}return _createClass(e,[{key:"setSearchRange",value:function(e){this.searchRangeSquared=Math.pow(e,2)}},{key:"setPoints",value:function(e){this.points=e}},{key:"meanShift",value:function(e){for(var t=e.clone(),n=[];;){var i=this.rangeSearch(t);this.connect(n,i);var o=this.mean(i);if(t.distanceToSquared(o)<=this.EPSILON_SQR)break;t=o}return n}},{key:"mean",value:function(e){var t=new Vector3,n=!0,i=!1,o=void 0;try{for(var a,r=e[Symbol.iterator]();!(n=(a=r.next()).done);n=!0){var s=a.value;t.add(s)}}catch(e){i=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(i)throw o}}return t.multiplyScalar(1/e.length),t}},{key:"rangeSearch",value:function(e){var t=[],n=!0,i=!1,o=void 0;try{for(var a,r=this.points[Symbol.iterator]();!(n=(a=r.next()).done);n=!0){var s=a.value;e.distanceToSquared(s)<=this.searchRangeSquared&&t.push(s)}}catch(e){i=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(i)throw o}}return t}},{key:"clustering",value:function(e,t){var n=this;if(this.tmpPoints=this.points,this.clusters.length>0){1===this.clusters.length&&1===this.clusters[0].parents.length&&(this._clusterId=1),this.points=[];var i=[].concat(_toConsumableArray(this.clusters));this.clusters=[];for(var o=0;o<i.length;o++){var a=i[o],r=[];t?this.points=a.points:(this.resetClusterPoints(a.points),this.points=a.points);var s=[],u=0;e?(u=++this._clusterId,s=a.parents):(u=a.parents.pop(),void 0===u&&(u=0),s=a.parents);var c=!0,l=!1,d=void 0;try{for(var f,h=a.points[Symbol.iterator]();!(c=(f=h.next()).done);c=!0){var g=f.value;if(!g.stopMoving){var v=this.meanShift(g);e?this.mergeClustersInTarget({points:v,center:this.mean(v),id:u,parents:[].concat(_toConsumableArray(s))},r):this.mergeClusters({points:v,center:this.mean(v),id:u,parents:[].concat(_toConsumableArray(s))})}}}catch(e){l=!0,d=e}finally{try{!c&&h.return&&h.return()}finally{if(l)throw d}}e&&this.clusters.push.apply(this.clusters,r)}}else{var m=!0,p=!1,y=void 0;try{for(var w,b=this.points[Symbol.iterator]();!(m=(w=b.next()).done);m=!0){var _=w.value;if(!_.stopMoving){var x=this.meanShift(_),I=++this._clusterId,C=[0];C.push(I),this.mergeClusters({points:x,center:this.mean(x),id:this._clusterId++,parents:C})}}}catch(e){p=!0,y=e}finally{try{!m&&b.return&&b.return()}finally{if(p)throw y}}}this.clusters.forEach(function(e){n.resetPointStatus(e.points)})}},{key:"mergeClusters",value:function(e){var t=!1,n=!0,i=!1,o=void 0;try{for(var a,r=this.clusters[Symbol.iterator]();!(n=(a=r.next()).done);n=!0){var s=a.value,u=e.center.distanceToSquared(s.center)<=4*this.searchRangeSquared,c=JSON.stringify(s.parents)===JSON.stringify(e.parents);if(u&&c){this.connect(s.points,e.points,!0),s.center=this.mean(s.points),this.updateClusterBbox(s),t=!0;break}}}catch(e){i=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(i)throw o}}!1===t&&(this.updateClusterBbox(e),this.clusters.push(e))}},{key:"mergeClustersInTarget",value:function(e,t){var n=!1,i=!0,o=!1,a=void 0;try{for(var r,s=t[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var u=r.value;if(e.center.distanceToSquared(u.center)<=4*this.searchRangeSquared){this.removeNodeFromParents(e.id,u.parents),this.connect(u.points,e.points,!0),u.center=this.mean(u.points),this.updateClusterBbox(u),n=!0;break}}}catch(e){o=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}!1===n&&(this.updateClusterBbox(e),e.id=++this._clusterId,e.parents.push(e.id),t.push(e))}},{key:"removeNodeFromParents",value:function(e,t){var n=t.indexOf(e);n>=0&&t.splince(n,1)}},{key:"updateClusterBbox",value:function(e){var t=(new Box3).setFromPoints(e.points);e.bbox=t}},{key:"connect",value:function(e,t,n){var i=!0,o=!1,a=void 0;try{for(var r,s=t[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var u=r.value;u.stopMoving&&!n||e.push(u),u.stopMoving=!0}}catch(e){o=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}return e}},{key:"resetPointStatus",value:function(e){var t=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){o.value.stopMoving=!1}}catch(e){n=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw i}}}},{key:"resetClusterPoints",value:function(e){for(var t=0;t<e.length;t++)for(var n=0;n<this.tmpPoints.length;n++)if(e[t].index===this.tmpPoints[n].index){e[t]=this.tmpPoints[n];break}}}]),e}();e.MeanShift=t}();var Vector2=function(){function e(t,n){_classCallCheck(this,e),this.x=t||0,this.y=n||0}return _createClass(e,[{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"normalize",value:function(){return this.multiplyScalar(1/this.length())}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),i=Math.sin(t),o=this.x-e.x,a=this.y-e.y;return this.x=o*n-a*i+e.x,this.y=o*i+a*n+e.y,this}},{key:"setLength",value:function(e){return this.multiplyScalar(e/this.length())}},{key:"angle",value:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}}]),e}(),Box2=function(){function e(t,n){_classCallCheck(this,e),this.min=t||new Vector2(1/0,1/0),this.max=n||new Vector2(-1/0,-1/0)}return _createClass(e,[{key:"getSize",value:function(){return new Vector2(this.max.x-this.min.x,this.max.y-this.min.y)}},{key:"setFromCenterAndSize",value:function(e,t){var n=new Vector2(t.x,t.y).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"getCenter",value:function(){return new Vector2(this.min.x+this.max.x,this.min.y+this.max.y).multiplyScalar(.5)}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}}]),e}();!function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Algorithm"),t=function e(){_classCallCheck(this,e)};t.toThreeJsBox2=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=[],i=!0,o=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var u=r.value,c=Math.min(t,100)/100,l=Math.max(u[1][1]-u[0][1],u[1][0]-u[0][0]),d=l*c,f=new Vector2(u[0][0],u[0][1]),h=new Vector2(u[1][0],u[1][1]),g=new Box2(f,h),v=g.getSize();n.push((new Box2).setFromCenterAndSize(g.getCenter(),v.addScalar(2*d)))}}catch(e){o=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}var m=0,p=!0,y=!1,w=void 0;try{for(var b,_=n[Symbol.iterator]();!(p=(b=_.next()).done);p=!0){b.value.indices=[m++]}}catch(e){y=!0,w=e}finally{try{!p&&_.return&&_.return()}finally{if(y)throw w}}return n},t.toDrawingBox2=function(e){var t=[],n=!0,i=!1,o=void 0;try{for(var a,r=e[Symbol.iterator]();!(n=(a=r.next()).done);n=!0){var s=a.value,u=[];u.push([s.min.x,s.min.y]),u.push([s.max.x,s.max.y]),t.push(u)}}catch(e){i=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(i)throw o}}return t},t.merge=function(e,t){for(var n=e.length,i=0;i<=n;i++){if(i===n){e.push(t);break}var o=e[i];if(o.intersectsBox(t)){o.union(t),o.indices=o.indices.concat(t.indices);break}}},t.mergeBoundingBox=function(e){for(var n=e,i=[];;){for(var o=0;o<n.length;o++)t.merge(i,n[o]);if(i.length===n.length)break;n=i.slice(0,i.length),i=[]}return i},e.BoundingBoxUtil=t}(),function(){function e(e){function t(){}return t.prototype=e,new t}function t(t,n){var i=e(n.prototype);i.constructor=t,t.prototype=i}Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Type").inheritPrototype=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),t=function(e,t){var n={type:"get",cache:!0,headers:{"Content-type":"application/x-www-form-urlencoded"},data:null,async:!0,success:null,failure:null},i=Object.assign(n,e),o=function(e){i.success&&i.success(e.responseText,e.responseXML)},a=function(e){i.failure&&i.failure(e)},r=function(e,t){var n;n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),n.onreadystatechange=function(){if(4==n.readyState){var i=n.status;if(i>=200&&i<300||304==i){var o=n,a=o.responseText,r=o.responseXML;e({responseText:a,responseXML:r})}else t(i)}},n.open(i.type,i.url,i.async);for(var o in i.headers)n.setRequestHeader(o,i.headers[o]);n.send(i.data)},s=function(){return new Promise(r)};t?CLOUD.Storage.IndexedDBHelper.loadWithStorage("InfoData",i.url,s,o,a):r(o,a)},n=function(e,t,n){var i={};if(i[e])t&&t();else{var o=document.createElement("script");o.type="text/javascript",o.src=e,document.head.appendChild(o),i[e]=!0,o.readyState?o.onreadystatechange=function(){"loaded"==o.readyState||"complete"==o.readyState?(o.onreadystatechange=null,t&&t()):"uninitialized"==o.readyState&&(o.onreadystatechange=null,n&&n())}:(o.onload=function(){t&&t()},o.onerror=function(){n&&n()})}},i=function e(t,i){t.length>1?n(t.shift(),function(){e(t,i)}):n(t.shift(),i)},o=function(e,n,i){var o=void 0;return o="string"==typeof e?{url:e,status:n}:e,new Promise(function(e,a){t(Object.assign({},o,{success:function(t){try{var i=JSON.parse(t)}catch(n){return e(t)}"success"==i.code||"noCode"==o.status?e("noCode"==n?i:i.data):a("requestErrorï¼ŒdataCode:"+i.code+", dataMessage:"+i.message)},failure:function(e){a(e)}}),i)})};e.ajax=t,e.promiseJSONRequest=o,e.getScript=n,e.getScripts=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.FullScreen"),t=function(e){if(!e)return!1;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()},n=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},i=function(){return document.webkitIsFullScreen||!!document.mozFullScreenElement||!!document.msFullScreenElement||!1},o=function(e){var t=function(){e&&e()};document.onfullscreenchange=t,document.onwebkitfullscreenchange=t,document.documentElement.onwebkitfullscreenchange=t,document.onmozfullscreenchange=t,document.onmsfullscreenchange=t};e.fullScreen=t,e.exitFullScreen=n,e.onFullScreenChanged=o,e.isFullScreen=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.ClientHelper"),t=null;if(!e.getIsDesktop){var n=function(){if("Mobile"===t)return!1;if("Web"===t)return!0;var e=navigator.userAgent,n=/(?:Windows Phone)/.test(e),i=/(?:SymbianOS)/.test(e)||n,o=/(?:Android)/.test(e),a=/(?:Firefox)/.test(e),r=(/(?:Chrome|CriOS)/.test(e),/(?:iPad|PlayBook)/.test(e)||o&&!/(?:Mobile)/.test(e)||a&&/(?:Tablet)/.test(e));return!(/(?:iPhone)/.test(e)&&!r||o||i||r)},i=function(e){t=e},o=function(){return/(?:iPhone)/.test(navigator.userAgent)},a=function(e){var t=function(e){return e.replace("viewToken.json","").replace(/\.\//g,"/").replace(/\/\//g,"/")};if(e.indexOf("://")>-1){var n=e.split("://");e=n[0]+"://"+t(n[1])}else e="//"===e.slice(0,2)?"//"+t(e.slice(2)):"./"!=e.slice(0,2)?t(e):"."+t(e.slice(1));return e},r=function(e,t,n){n=n||"asc";var i=!1;return t?t.indexOf(".")>-1&&(i=!0):t="name",e=e.sort(function(e,o){if(i){var a=l(e,t),r=l(o,t);return"asc"==n?a.localeCompare(r):r.localeCompare(a)}return"asc"==n?e[t].localeCompare(o[t]):o[t].localeCompare(e[t])}),c(e,t,i)},s=function(e,t,n){n=n||"asc";var i=!1;return t?t.indexOf(".")>-1&&(i=!0):t="name",e=e.sort(u(t,i)),c(e,t,i)},u=function(e,t){return function(n,i){function o(e,t,n){if(n){for(s=t;(n=o(e,s))<76&&n>65;)++s;return+e.slice(t-1,s)}return n=h&&h.indexOf(e.charAt(t)),n>-1?n+76:(n=e.charCodeAt(t)||0)<45||n>127?n:n<46?65:n<48?n-1:n<58?n+18:n<65?n-11:n<91?n+11:n<97?n-37:n<123?n+5:n-63}var a,r;t?(a=l(n,e),r=l(i,e)):(a=n[e],r=i[e]);var s,u,c=1,d=0,f=0,h=String.alphabet;if((a+="")!=(r+=""))for(;c;)if(u=o(a,d++),c=o(r,f++),u<76&&c<76&&u>66&&c>66&&(u=o(a,d,d),c=o(r,f,d=s),f=s),u!=c)return u<c?-1:1;return 0}},c=function(e,t,n){var i=[],o=[],a=[],r=[];return e.map(function(e,s){var u;u=n?l(e,t):e[t],/^[a-zA-Z]*$/.test(u.slice(0,1))?i.push(e):/^[\u4e00-\u9fa5]*$/.test(u.slice(0,1))?o.push(e):/^\d+(\.\d+)?$/.test(u.slice(0,1))?a.push(e):r.push(e)}),r.concat(a,i,o)},l=function(e,t){var n=t.split("."),i=e;return n.map(function(e,t){i=i[e]}),i},d=function(){return!!(window.ActiveXObject||"ActiveXObject"in window)},f=function(e,t,n,i,o,a){var r=void 0,s=void 0,u=void 0,c=void 0,l=0,d=Math.sqrt((n-e)*(n-e)+(i-t)*(i-t));if(0===d)return[0,{x:n,y:i}];var f=Math.sqrt((o-e)*(o-e)+(a-t)*(a-t));if(0===f)return[0,{x:o,y:a}];var h=Math.sqrt((n-o)*(n-o)+(i-a)*(i-a));if(0===h)return l=d,[l,{x:n,y:i}];if(d<f){if(i===a?r=n<o?0:Math.PI:(c=(o-n)/h,c-1>1e-5&&(c=1),r=Math.acos(c),i>a&&(r=2*Math.PI-r)),c=(e-n)/d,c-1>1e-5&&(c=1),s=Math.acos(c),i>t&&(s=2*Math.PI-s),u=s-r,u<0&&(u=-u),u>Math.PI&&(u=2*Math.PI-u),u>Math.PI/2)return[d,{x:n,y:i}];if(n===o)return[f*Math.sin(u),{x:n,y:t}];if(i===a)return[f*Math.sin(u),{x:e,y:i}];var g=0,v=0,m=(a-i)/o-n,p=-1/m,y=t-e*p;return g=(a-o*m-y)/(p-m),v=p*g+y,[d*Math.sin(u),{x:g,y:v}]}if(i===a?r=n<o?Math.PI:0:(c=(n-o)/h,c-1>1e-5&&(c=1),r=Math.acos(c),a>i&&(r=2*Math.PI-r)),c=(e-o)/f,c-1>1e-5&&(c=1),s=Math.acos(c),a>t&&(s=2*Math.PI-s),u=s-r,u<0&&(u=-u),u>Math.PI&&(u=2*Math.PI-u),u>Math.PI/2)return[f,{x:o,y:a}];if(n===o)return[f*Math.sin(u),{x:n,y:t}];if(i===a)return[f*Math.sin(u),{x:e,y:i}];var w=0,b=0,_=(a-i)/o-n,x=-1/_,I=t-e*x;return w=(a-o*_-I)/(x-_),b=x*w+I,[f*Math.sin(u),{x:w,y:b}]},h=function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},g=function(){try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}};e.getIsDesktop=n,e.setNavigatorType=i,e.getIsIphone=o,e.getIsIE=d,e.formatURL=a,e.sortByName=r,e.sortByRules=s,e.PointToLineDistance=f,e.isWebGLAvailable=h,e.isWebGL2Available=g}}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.MouseMotion"),t=function(e){function t(){n&&"walk"==e.getViewer().getEditorManager().editor.name||(i.addClass("motion-zoom"),o=Date.now(),setTimeout(function(){Date.now()-o>180&&i.removeClass("motion-zoom")},200))}var n=!1,i=e.getDomElement(),o=void 0,a=!1,r=!1,s=null;Glodon.Bimface.Viewer.Viewer3D&&e instanceof Glodon.Bimface.Viewer.Viewer3D&&(n=!0),i.addEventListener("keydown",function(e){17==event.keyCode&&(a=!0)}),i.addEventListener("keyup",function(e){17==event.keyCode&&(a=!1)}),i.addEventListener("mousedown",function(t){e._opt.enableZoomRect||a||(s={x:t.clientX,y:t.clientY})}),i.addEventListener("mousemove",function(t){if(s&&!r&&!(Math.abs(s.x-t.clientX)<2&&Math.abs(s.y-t.clientY)<2)){if(n){var o=e.getUseLeftHandedInput();if("walk"==e.getViewer().getEditorManager().editor.name)1==t.buttons&&i.addClass("motion-rotate");else{var a=e._getIsCursorEnabled();1==t.buttons?a&&i.addClass(o?"motion-rotate":"motion-translate"):i.addClass(o?"motion-translate":"motion-rotate")}}else 1==t.buttons&&i.addClass("motion-translate");r=!0}}),i.addEventListener("mousewheel",t,!1),i.addEventListener("DOMMouseScroll",t,!1),i.addEventListener("mouseup",function(e){s=!1,r=!1,i.removeClass("motion-translate"),i.removeClass("motion-rotate")})};e.setCursor=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=function(e,t){var n=document.createElement(e);return n.setAttribute("class",t),n};e.create=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg",e);return n.setAttribute("class",t),n};e.createNS=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=function(e){return e.indexof("#")?document.getElementById(e.replace("#","")):e.indexof(".")?document.getElementsByClassName(e.replace(".","")):document.getElementsByTagName(e)};e.select=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=function(e){var t=Glodon.Web.Lang.Utility.ClientHelper.getIsDesktop(),n={element:null,handle:null,axis:"all",cursor:"move",distance:0,start:null,move:null,stop:null,bBoxDetection:!1},i=Object.assign(n,e),o=i.element;if(!o)return!1;var a=i.handle||o,r=void 0,s=!1,u=this,c=function(e){return Math.pow(e.x,2)+Math.pow(e.y,2)>Math.pow(i.distance,2)&&(i.start&&i.start(r),!0)},l=function(e){var t=navigator.userAgent;return t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1&&!isOpera?1==e:0==e};this.resize=function(e,t,n){t=t||{x:0,y:0};var o=e.getBoundingClientRect(),a=e.parentElement.getBoundingClientRect(),r=o.left-a.left,s=o.top-a.top,u=e.offsetWidth,c=e.offsetHeight,l=e.parentElement.offsetWidth,d=e.parentElement.offsetHeight,f=Math.min(r+t.x,l-u),h=Math.min(s+t.y,d-c),g=r+t.x<0?0:f>0&&f||0,v=s+t.y<0?0:h>0&&h||0;n&&0!=g&&0!=v||(e.style.left=g+"px",e.style.top=v+"px",e.style.transform="none",i.record&&i.record(g,v))};var d=function(e){var t=o.getBoundingClientRect(),n=o.parentElement.getBoundingClientRect(),a=t.left-n.left,r=t.top-n.top;if(i.bBoxDetection)u.resize(o,e);else{var s=a+e.x,c=r+e.y;switch(i.axis){case"x":o.style.left=s+"px";break;case"y":o.style.top=c+"px";break;case"all":default:o.style.left=s+"px",o.style.top=c+"px"}}},f=function(e){var n=e;if(t){if(!l(n.button))return;r={x:n.clientX,y:n.clientY},document.addEventListener("mousemove",h)}else r={x:n.touches[0].clientX,y:n.touches[0].clientY},a.addEventListener("touchmove",h);i.start&&i.start(r)},h=function(e){var n=e;if(t)var o={x:n.clientX,y:n.clientY};else var o={x:n.touches[0].clientX,y:n.touches[0].clientY};var a={x:o.x-r.x,y:o.y-r.y};s?(i.move&&i.move(r,o,a),r=o,d(a)):s=c(a),e.preventDefault(),e.stopPropagation()},g=function(){s&&i.end&&i.end(r),s=!1,document.removeEventListener("mousemove",h),a.removeEventListener("touchmove",h)};t?(a.style.cursor=i.cursor,a.style.userSelect="none",a.addEventListener("mousedown",f),document.addEventListener("mouseup",g)):(a.addEventListener("touchend",g),a.addEventListener("touchstart",f))};e.drag=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=function(t){var n={element:null,axis:"all",minWidth:100,minHeight:100,distance:0,start:null,sizable:null,stop:null},i=Object.assign(n,t),o=i.element;if(!o)return!1;var a,r,s=void 0,u=!1,c=e.create("div","bf-resize"),l=function(e){return Math.pow(e.x,2)+Math.pow(e.y,2)>Math.pow(i.distance,2)&&(i.start&&i.start(s),!0)},d=function(e){var t=navigator.userAgent;return t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1&&!isOpera?1==e:0==e},f=function(e){var t=o.offsetLeft,n=o.offsetTop,s=a+e.x<i.minWidth?i.minWidth:a+e.x,u=r+e.y<i.minHeight?i.minHeight:r+e.y;switch(i.resize&&i.resize(s,u),o.style.left=t+"px",o.style.top=n+"px",i.axis){case"x":o.style.width=s+"px";break;case"y":o.style.height=u+"px";break;case"all":default:o.style.width=s+"px",o.style.height=u+"px"}},h=function(e){a=o.clientWidth,r=o.clientHeight;var t=e;d(t.button)&&(s={x:t.clientX,y:t.clientY},document.addEventListener("mousemove",g),document.addEventListener("touchmove",g))},g=function(e){var t=e,n={x:t.clientX,y:t.clientY},o={x:n.x-s.x,y:n.y-s.y};u?(i.sizable&&i.sizable(s,n,o),f(o)):u=l(o)},v=function(){u&&i.end&&i.end(s),u=!1,document.removeEventListener("mousemove",g),document.removeEventListener("touchmove",g)};o.addClass("bf-sizable"),o.appendChild(c),c.addEventListener("mousedown",h),c.addEventListener("touchstart",h),document.addEventListener("mouseup",v),document.addEventListener("touchend",v)};e.sizable=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=function(t){var n=this,i={element:null,min:0,max:100,cur:50,step:1,isShowProgress:!0,input:null,change:null,currentColor:"#11dab7",defaultColor:"#999"},o=Object.assign(i,t);this._opt=o;var a=e.create("div","bf-range"),r=e.create("input","bf-input-range");n.input=r,r.setAttribute("type","range"),r.setAttribute("step",o.step),r.setAttribute("min",o.min),r.setAttribute("max",o.max),r.setAttribute("value",o.cur);var s=e.create("span","bf-range-min");s.innerText=o.min;var u=e.create("span","bf-range-cur");n.cur=u,u.innerText=o.cur;var c=e.create("span","bf-range-max");c.innerText=o.max;var l=e.create("span","bf-range-progress");a.appendChild(r),o.isShowProgress&&(a.appendChild(s),a.appendChild(u),a.appendChild(c)),a.appendChild(l),o.element.appendChild(a),n.setProgress(o.cur),r.addEventListener("input",function(){n.setProgress(this.value),o.input&&o.input(this.value)}),r.addEventListener("change",function(){n.setProgress(this.value),o.change&&o.change(this.value)})};t.prototype.setProgress=function(e){var t=this._opt,n=t.max-t.min,i=this.input,o=this.cur,a=(e-t.min)/n*100;i.value=e,i.style.background="linear-gradient(to right,"+t.currentColor+" 0%,"+t.currentColor+"  "+a+"%,"+t.defaultColor+" "+a+"%, "+t.defaultColor+" 100%)",o.innerText=e},t.prototype.reset=function(){this.setProgress(this._opt.cur)},e.range=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=function(e){var t={element:null,min:0,max:100,from:null,to:null,step:1,currentColor:"#11dab7",defaultColor:"#999",change:null};this._opt=Object.assign(t,e),this._opt.from=this._opt.from||this._opt.min,this._opt.to=this._opt.to||this._opt.max,this.init()};t.prototype={init:function(){var t=e.create("div","bf-multiple-range"),n=e.create("div","bf-range-track"),i=e.create("span","bf-slider bf-slider-min");i.id="minSlider",i.type="minimum";var o=e.create("span","bf-slider bf-slider-max");o.id="maxSlider",o.type="maximum",this._state={from:this._opt.from,to:this._opt.to},n.style.backgroundColor=this._opt.currentColor,t.style.backgroundColor=this._opt.defaultColor,t.appendChild(n),t.appendChild(i),t.appendChild(o),this._opt.element.appendChild(t),this._track=n,this._sliders={min:i,max:o},this._element=t,this.bindEvent(),this.update(!1)},bindEvent:function(){var e,t,n=this,i=!1,o=function(n){var n=n||event;t=n.screenX,e=this,i=!0},a=function(o){if(i){var o=o||event,a=o.screenX-t,r=Math.round(a/n._pix/n._opt.step)*n._opt.step;0!=r&&(t=r*n._pix+t,"minimum"==e.type?n._state.from+=r:n._state.to+=r,n.recalculate(e),n.update(!0))}},r=function(){e=null,i=!1};this._sliders.min.addEventListener("mousedown",o),this._sliders.max.addEventListener("mousedown",o),document.addEventListener("mousemove",a),document.addEventListener("mouseup",r)},update:function(e){var t=this._sliders.min.offsetWidth,n=this._sliders.max.offsetWidth;if(!this._pix){var i=this._element.offsetWidth,o=this._opt.max-this._opt.min,a=(i-t-n)/o;this._pix=a}var r=(this._state.from-this._opt.min)*this._pix,s=(this._state.to-this._opt.min)*this._pix+t+n;this._track.style.left=r+t/2+"px",this._track.style.width=s-r-t/2-n/2+"px",this._sliders.min.style.left=r+"px",this._sliders.max.style.left=s+"px",this._opt.change&&e&&this._opt.change(this._state)},recalculate:function(e){this._state.to>=this._opt.max&&(this._state.to=this._opt.max),this._state.from<=this._opt.min&&(this._state.from=this._opt.min),e&&("maximum"==e.type&&this._state.to<=this._state.from&&(this._state.to=this._state.from),"minimum"==e.type&&this._state.from>=this._state.to&&(this._state.from=this._state.to))},getProgress:function(){return this._state},setProgress:function(e){this._state=e,this.recalculate(),this.update(!1)}},e.multipleRange=t}(),function(){var e=function(e){var t,n;this.addEventListener("touchstart",function(e){t=Date.now()}),this.addEventListener("touchend",function(i){(n=Date.now())-t<200&&e(i)})};HTMLElement.prototype.tap=e}(),function(){(window.ActiveXObject||"ActiveXObject"in window)&&(HTMLElement.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)},window.Element&&function(e){e.matches=e.matches||e.matchesSelector||e.webkitMatchesSelector||e.msMatchesSelector||function(e){for(var t=this,n=(t.parentNode||t.document).querySelectorAll(e),i=-1;n[++i]&&n[i]!=t;);return!!n[i]}}(Element.prototype),window.Element&&function(e){e.closest=e.closest||function(e){for(var t=this;t.matches&&!t.matches(e);)t=t.parentNode;return t.matches?t:null}}(Element.prototype))}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.UUID"),t=function(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")};e.createUUID=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility"),t=function(e,t){var n=null,i=Date.now();return void 0==t&&(t=30),function(){var o=Date.now(),a=t-(o-i),r=this,s=arguments;clearTimeout(n),a<=0?(e.apply(r,s),i=Date.now()):n=setTimeout(e,a)}};e.throttle=t}();var UtilityNS=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility");UtilityNS.DataUtil={assertType:function(e,t){var n=function(t){return Object.prototype.toString.call(e)==="[object "+t+"]"};switch(t){case"obj":case"Obj":case"object":case"Object":return n("Object");case"arr":case"Arr":case"array":case"Array":return n("Array");case"num":case"Num":case"number":case"Number":return n("Number");case"func":case"Func":case"function":case"Function":return n("Function");case"str":case"Str":case"string":case"String":return n("String");default:return n(t)}},assertParamsType:function(){for(var e=this,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];if(n.length>1){var o=n.splice(n.length-1,1),a=_slicedToArray(o,1),r=a[0],s=!0;return n.every(function(t){return s=e.assertType(t,r)}),s}},hasProperty:function(e,t){return!!this.assertType(e,"obj")&&e.hasOwnProperty(t)},hasProperties:function(e){for(var t=this,n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];if(!i)return!1;var a=!0;return i.every(function(n){return a=t.hasProperty(e,n)}),a},hasChildProperty:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(!n||0===n.length)return!1;for(var o=e,a=0;a<n.length;a++){var r=n[a];if(!this.hasProperty(o,r))return!1;o=o[r]}return!0},getChildProperty:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(this.hasChildProperty.apply(this,[e].concat(_toConsumableArray(n)))){var o=e
;return n.forEach(function(e){return o=o[e]}),o}}},UtilityNS.DataUtil,function(){Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Utils").Transformation={getTranslation:function(e){var t=this._getDecompose(e);return{x:t.position.x,y:t.position.y,z:t.position.z}},getQuaternion:function(e){var t=this._getDecompose(e);return{x:t.quaternion._x,y:t.quaternion._y,z:t.quaternion._z,w:t.quaternion._w}},getScaling:function(e){var t=this._getDecompose(e);return{x:t.scale.x,y:t.scale.y,z:t.scale.z}},quaternionToEulerAngles:function(e,t){var n=new THREE.Euler,i=new THREE.Quaternion(e.x,e.y,e.z,e.w),o=n.setFromQuaternion(i,t||"XYZ");return{x:o._x,y:o._y,z:o._z,order:o._order}},eulerAnglesToQuaternion:function(e){var t=new THREE.Quaternion,n=new THREE.Euler(e.x,e.y,e.z,e.order),i=t.setFromEuler(n);return{x:i._x,y:i._y,z:i._z,w:i._w}},_getDecompose:function(e){var t=new THREE.Matrix4,n=new THREE.Vector3,i=new THREE.Quaternion,o=new THREE.Vector3;return t.fromArray(e),t.decompose(n,i,o),{position:n,quaternion:i,scale:o}}}}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang"),t=function(){this.container={}};t.prototype.addEvent=function(e,t){return"string"==typeof e&&"function"==typeof t&&(void 0===this.container[e]?this.container[e]=[t]:this.container[e].push(t)),this},t.prototype.fireEvent=function(e){if(e&&this.container[e]){var t=Array.prototype.slice.call(arguments);t.shift();for(var n=[].concat(_toConsumableArray(this.container[e])),i=n.length,o=0;o<i;o++){n[o].apply(null,t)}}return this},t.prototype.removeEvent=function(e,t){if("function"==typeof t&&"string"==typeof e){var n=this.container[e];if(n instanceof Array){for(var i=0,o=n.length;i<o;i+=1)if(n[i]===t){n.splice(i,1);break}0==n.length&&delete this.container[e]}return this}},e.EventManager=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Geometry"),t=function(e,t,n){this.x=e,this.y=t,this.z=n};t.prototype={get:function(){return{x:this.x,y:this.y,z:this.z}},set:function(e,t,n){this.x=e,this.y=t,this.z=n}},e.Point3d=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Geometry"),t=function(t,n){var i={},o=new e.Point3d,a=new e.Point3d;return o.set(t.x,t.y,t.z),a.set(n.x,n.y,n.z),i.min=o,i.max=a,i};e.BoundingBox=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Graphics.Utility"),t=function(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t};e.RGBToHex=t}();var hostConfig=window.hostConfig||{APIHost:"https://api.bimface.com",resourceHost:"https://m.bimface.com",staticHost:"https://static.bimface.com",dataEnvType:"BIMFACE"};!function(){function e(e,t){function n(e){return"FloorPlan"==e||"CeilingPlan"==e}if("DrawingSheet"!=t.viewType)return null;var i=t.viewInfo,o=i.preview.width,a=i.preview.height,r=i.outline[0],s=i.outline[2],u=i.outline[1],c=i.outline[3],l=s-r,d=c-u;i=t;for(var f=i.portsAndViews,h=0;h<f.length;h++){var g=f[h];if(n(g.viewType)){var v=function(t,n,i,s,c){var f=e.x/o,h=(a-e.y)/a;if("Elevation"==c.viewType){h=(o-e.x)/o,f=e.y/a;var g=c.viewPoint.viewDirection;1!=Math.round(g[0])&&-1!=Math.round(g[1])||(f=(a-e.y)/a)}var v=(t-r)/l,m=(n-r)/l;if(f<v||f>m)return null;var p=(i-u)/d,y=(s-u)/d;if(h<p||h>y)return null;var w=(f-v)/(m-v),b=(h-p)/(y-p),_=((c.outline[2]-c.outline[0])*w+c.outline[0])*c.viewPoint.scale,x=((c.outline[3]-c.outline[1])*b+c.outline[1])*c.viewPoint.scale;return new THREE.Vector3(_,x,0)}(g.viewport[0],g.viewport[3],g.viewport[1],g.viewport[4],g);if(null!=v){if(n(g.viewType))null!==v&&(v.z=g.elevation);else if("Elevation"==g.viewType){var m=g.viewPoint.viewDirection,p=g.cropBox;0!=Math.round(m[0])?null!==v&&(v.z=v.y,v.y=v.x,v.x=m[0]<0?p[3]:p[0]):0!=Math.round(m[1])&&null!==v&&(v.z=v.y,v.y=m[1]<0?p[4]:p[1])}return v}}}return null}function t(e,t,n){if("DrawingSheet"!=t.viewType)return!1;var i=t.preview.width,o=t.preview.height,a=t.outline[0],r=t.outline[2],s=t.outline[1],u=t.outline[3],c=t.portsAndViews;for(var l in c){var d=c[l];if("FloorPlan"===d.viewType){var f=d.viewPoint.scale,h=d.outline[0]*f,g=d.outline[2]*f,v=d.outline[1]*f,m=d.outline[3]*f;if(!(e.x<h||e.x>g||e.y<v||e.y>m)){var p=(e.x-h)/(g-h),y=(e.y-v)/(m-v),w=d.viewport[3]-d.viewport[0],b=d.viewport[4]-d.viewport[1];n(i*((d.viewport[0]+w*p-a)/(r-a)),o-o*((d.viewport[1]+b*y-s)/(u-s)),d)}}}return!0}var n=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Graphics.Utility.Relation"),i=function(e,t,n){Glodon.Web.Lang.Utility.HttpRequest.ajax({url:hostConfig.resourceHost+"/"+e+"/metadata/views.json",success:function(i){var o=JSON.parse(i).viewList,i=[];for(var a in o){var r=o[a];r.viewType==t&&(r.preview.path=hostConfig.resourceHost+"/"+e+"/"+r.preview.path,i.push(r))}n&&n(i)}})},o=function(e,t,n){Glodon.Web.Lang.Utility.HttpRequest.ajax({url:hostConfig.resourceHost+"/"+e+"/metadata/drawings.json",success:function(e){for(var i=JSON.parse(e).drawingList,o=0;o<i.length;o++){var a=i[o];if(a.viewInfo.id==t){n&&n(a);break}}}})},a=function(t,n){if("DrawingSheet"==n.viewType)return e(t,n);if("FloorPlan"!=n.viewType)return console.warn("Not support yet!"),null;var i=n.preview.width,o=n.preview.height,a=n.outline[0],r=n.outline[2],s=n.outline[1],u=n.outline[3],c=r-a,l=u-s,d=(0-a)/c,f=u/l,h=(t.x-i*d)/i,g=(o*f-t.y)/o;return h=h*c*n.viewPoint.scale,g=g*l*n.viewPoint.scale,new Glodon.Web.Geometry.Point3d(h,g,n.elevation)},r=function(e,n){var i=[];if(t(e,n,function(e,t,n){i.append({x:e,y:t})}))return 0==i.length?null:i;if("FloorPlan"!=n.viewType)return console.warn("Not support yet!"),null;var o=n.preview.width,a=n.preview.height,r=n.outline[0],s=n.outline[2],u=n.outline[1],c=n.outline[3],l=s-r,d=c-u,f=(0-r)/(s-r),h=c/(c-u),g=e.x/(l*n.viewPoint.scale),v=e.y/(d*n.viewPoint.scale);return g=g*o+o*f,v=a*h-v*a,{x:g,y:v,z:0}};n.getViews=i,n.getDrawingSheets=o,n.point2DToPoint3D=a,n.point3DToPoint2D=r}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Graphics.Utility"),t=function(e){var t=new Image;return new Promise(function(n,i){t.onload=function(){n(t)},t.onerror=function(e){i(e)},t.crossOrigin="anonymous",t.src=e,!0===t.complete&&n(t)})};e.ImageContainer=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Graphics"),t=Glodon.Web.Graphics.Utility.RGBToHex,n=function(e,t,n,i){this.red=e,this.green=t,this.blue=n,this.alpha=i},i=function(e,t){/^#[0-9a-fA-F]{6}$/.test(e)&&(this.red=parseInt(e.slice(1,3),16),this.green=parseInt(e.slice(3,5),16),this.blue=parseInt(e.slice(5),16)),"number"==typeof t?(t>1&&(t=1),t<0&&(t=0),this.alpha=t):this.alpha=1},o=function(){arguments.length<4?i.apply(this,arguments):n.apply(this,arguments)};o.prototype={getRGB:function(){return"rgba("+this.red+","+this.green+","+this.blue+")"},getRGBA:function(){return"rgba("+this.red+","+this.green+","+this.blue+","+this.alpha+")"},getHEX:function(){return""+t(this.red)+t(this.green)+t(this.blue)},getAlpha:function(){return this.alpha},fromObject:function(e){return this.red=e.red,this.green=e.green,this.blue=e.blue,this.alpha=e.alpha,this}},e.Color=o}(),function(){SVGElement.prototype.getClass=HTMLElement.prototype.getClass=function(e){return this.getAttribute("class")},SVGElement.prototype.hasClass=HTMLElement.prototype.hasClass=function(e){var t=this.getClass();return!!t&&(t&&t.split(" ")).indexOf(e)>-1},SVGElement.prototype.addClass=HTMLElement.prototype.addClass=function(e){var t=this.getClass(),n=t&&t.split(" ");return t?-1==n.indexOf(e)&&(n.push(e),t=n.join(" "),this.setAttribute("class",""+t)):this.setAttribute("class",""+e),this},SVGElement.prototype.removeClass=HTMLElement.prototype.removeClass=function(e){if(!this.hasClass(e))return this;var t=this.getClass().replace(e,"").trim();return t?this.setAttribute("class",""+t):this.removeAttribute("class"),this},SVGElement.prototype.toggleClass=HTMLElement.prototype.toggleClass=function(e,t){var n=(this.getClass(),this.hasClass(e));return void 0!=t?(t&&!n&&this.addClass(e),t||this.removeClass(e)):n?this.removeClass(e):this.addClass(e),!n}}(),function(){Array.prototype.getObjectByAttribute=function(e,t){for(var n=this,i=n.length,o=0;o<i;o++)if(n[o][e]==t)return n[o];return!1},Array.prototype.removeObjectByAttribute=function(e,t){for(var n=this,i=n.length,o=0;o<i;o++)if(n[o][e]==t)return n=n.splice(o,1);return!1},Array.prototype.getAllObjectByAttribute=function(e,t){for(var n=this,i=n.length,o=0,a=[];o<i;o++)n[o][e]==t&&a.push(n[o]);return a},Array.prototype.removeByValue=function(e){for(var t=this,n=t.length,i=n-1;i>=0;i--)t[i]==e&&t.splice(i,1);return t},Array.prototype.insert=function(e,t){return this.splice(e,0,t),this}}(),function(){SVGElement.prototype.setCss=HTMLElement.prototype.setCss=function(e){if(e)for(var t in e)this.style[t]=e[t]},SVGElement.prototype.getCss=HTMLElement.prototype.getCss=function(){return this.style}}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Authentication"),t=function(){return{APIHost:hostConfig.APIHost,viewToken:null,enableStorage:!1}};e.AuthenticationConfig=t}();var IndexedDBHelper=function(){function e(t){_classCallCheck(this,e),this.indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,this.indexedDB||console.log("IndexedDB not supported"),this._db=null,this._opt=t}return _createClass(e,[{key:"open",value:function(e,t){var n=this,i=e||this._opt.name,o=t||this._opt.version||1,a=this.indexedDB.open(i,o);return new Promise(function(e,t){a.onsuccess=function(t){n._db=a.result,e(n._db)},a.onupgradeneeded=function(e){var t=n._db=e.target.result;(n._opt.storeList||[]).forEach(function(e){return!t.objectStoreNames.contains(e)&&t.createObjectStore(e)})},a.onerror=function(e){t(e)}})}},{key:"getDB",value:function(){var e=this;return new Promise(function(t,n){e._db?t(e._db):e.open().then(t).catch(n)})}},{key:"addObject",value:function(e,t,n){var i=this;return new Promise(function(o,a){i.getDB().then(function(i){var r=i.transaction(e,"readwrite");r.objectStore(e).put(t,n).onsuccess=function(e){o(e.target.result)},r.onerror=function(e){a(e)}}).catch(a)})}},{key:"getObject",value:function(e,t){var n=this;return new Promise(function(i,o){n.getDB().then(function(n){var a=n.transaction(e,"readonly");a.objectStore(e).get(t).onsuccess=function(e){var t=e.target.result;t?i(t):o(e)},a.onerror=function(e){o(e)}}).catch(o)})}},{key:"deleteObject",value:function(e,t){var n=this;return new Promise(function(i,o){n.getDB().then(function(n){var a=n.transaction(e,"readwrite");a.objectStore(e).delete(t).onsuccess=function(e){i(e.target.result)},a.onerror=function(e){o(e)}}).catch(o)})}},{key:"clearStore",value:function(e){var t=this;return new Promise(function(n,i){t.getDB().then(function(t){var o=t.transaction(e,"readwrite");o.objectStore(e).clear().onsuccess=function(e){n(e.target.result)},o.onerror=function(e){i(e)}}).catch(i)})}},{key:"deleteDB",value:function(e){var t=this;return new Promise(function(n){t.indexedDB.deleteDatabase(e).onsuccess=n})}},{key:"getAllKeys",value:function(e){var t=this;return new Promise(function(n,i){t.getDB().then(function(t){var o=t.transaction(e,"readonly");o.objectStore(e).getAllKeys().onsuccess=function(e){return n(e.target.result)},o.onerror=i}).catch(i)})}},{key:"getAll",value:function(e){var t=this;return new Promise(function(n,i){t.getDB().then(function(t){var o=t.transaction(e,"readonly");o.objectStore(e).getAll().onsuccess=function(e){return n(e.target.result)},o.onerror=i}).catch(i)})}}]),e}(),LoaderStorageManager=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{name:"Bf_Loader",version:1,storeList:["d","t"]}))}return _inherits(t,e),_createClass(t,[{key:"getDatabagInfo",value:function(e,t){var n=this;return new Promise(function(i,o){t?n.getObject("d",e).then(function(e){return n.addTemp(e,t).then(function(){return i(e)}).catch(o)}).catch(o):n.getObject("d",e).then(i).catch(o)})}},{key:"addDatabagInfo",value:function(e,t){var n=this;return new Promise(function(i,o){var a=e.modelId,r=function(){return Promise.all([n.addObject("d",e,a),n.addTemp(e,t)]).then(i).catch(o)};n.getDatabagInfo(a).then(function(t){t.databagId!==e.databagId&&n.deleteDB("Bf_"+data.databagId),r()}).catch(function(){r()})})}},{key:"deleteDatabagInfo",value:function(e){var t=this;return new Promise(function(n,i){t.deleteObject("d",e).then(n).catch(i)})}},{key:"addTemp",value:function(e,t){var n=this;return new Promise(function(i,o){n.clearStore("t").then(function(){n.addObject("t",e,t).then(i).catch(o)}).catch(o)})}},{key:"getTemp",value:function(e){var t=this;return new Promise(function(n,i){t.getObject("t",e).then(n).catch(i)})}},{key:"deleteStorageByModelId",value:function(e){var t=this;return new Promise(function(n,i){t.getDatabagInfo(e).then(function(o){var a="gisView"===o.renderType?"Bg_"+o.modelId:"Bf_"+o.databagId;Promise.all([t.deleteDB(a),t.deleteDatabagInfo(e)]).then(n).catch(i)}).catch(n)})}},{key:"getStoredModelIds",value:function(){return this.getAllKeys("d")}},{key:"getStoredModelInfo",value:function(){var e=this;return new Promise(function(t,n){e.getAll("d").then(function(e){var n=e.map(function(e){return{modelId:e.modelId,name:e.name,type:e.renderType}});t(n)}).catch(n)})}}]),t}(IndexedDBHelper);!function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Authentication"),t=(Glodon.Web,Glodon.Web.Lang.Utility.HttpRequest),n=function(e){this.config=e};n.prototype.authenticate=function(e,n){var i=this,o=i.config,a=function(){t.ajax({url:o.APIHost+"/inside/databag?viewToken="+o.viewToken,async:!0,success:function(t){var a=JSON.parse(t);"success"==a.code?(a.data.viewToken=o.viewToken,i.data=a.data,e&&e(a.data)):n&&n(a)},failure:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=JSON.parse(e);n&&n(t)})})},r=function(t){t.viewToken=o.viewToken,i.data=t,e&&e(t)};o.enableStorage?(new LoaderStorageManager).getTemp(o.viewToken).then(r).catch(a):a()},e.AuthenticationManager=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=function(){return{APIHost:hostConfig.APIHost,resourceHost:hostConfig.resourceHost,viewToken:null,modelId:null,modelType:"singleModel",dataEnvType:hostConfig.dataEnvType||"BIMFACE"}};e.MetaDataManagerConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=Glodon.Web.Lang.Utility.HttpRequest.promiseJSONRequest,n=Glodon.Web.Lang.Utility.HttpRequest.ajax,i={getAreas:function(e){var n=e.relativeUrl+"/data/spaces.json";return t(n)},getMepSystem:function(e,n){if("integrateModel"==n.modelType)var i=n.relativeUrl+"/metadata/"+e+"/mepsystem.json";else var i=n.relativeUrl+"/metadata/mepsystem.json";return t(i,"noCode")},getTreeOldData:function(e){if("singleModel"==e.modelType)var n=e.relativeUrl+"/data/tree.json";else var n=e.relativeUrl+"/data/specialtyTree.json";return t(n)},getTreeNewData:function(e){var n=e.relativeUrl+"/data/tree.json";return t(n)},getObjectData:function(e,t){return new Promise(function(n,i){if(t._objectData)n(t._objectData);else{var o=new Glodon.Bimface.Data.ObjectPropertyManager(e.relativeUrl+"/property");o.load(function(){t._objectData=o,n(t._objectData)})}})},getMaterialProperty:function(e,n){var i=n.split(".");if("singleModel"==e.modelType)var o=e.relativeUrl+"/metadata/materialmap.json";else var o=e.relativeUrl+"/metadata/"+i[0]+"/materialmap.json";return t(o,"noCode")},getMaterialPropertyItem:function(e,n,i){var o=n.split("."),a="singleModel"==e.modelType?e.relativeUrl+"/metadata/materials/"+i+".json":e.relativeUrl+"/metadata/"+o[0]+"/materials/"+i+".json";return t(a,"noCode")},getAreaProperty:function(e,n){var i=e.split("_");if("singleModel"==n.modelType)var o=n.relativeUrl+"/metadata/areas.json";else var o=n.relativeUrl+"/metadata/"+i[0]+"/areas.json";return t(o,"noCode")},getRoomProperty:function(e,n){var i=e.split("_");if("singleModel"==n.modelType)var o=n.relativeUrl+"/metadata/rooms.json";else var o=n.relativeUrl+"/metadata/"+i[0]+"/rooms.json";return t(o,"noCode")},getFiles:function(e){var n=e.relativeUrl+"/data/files.json";return t(n)},getDrawingsheets:function(e,n){var i=e.relativeUrl+"/metadata/drawings.json";return t(i,"noCode")},getMapInfo:function(e){var t=this,i=(t._opt,{}),o=[];t._helper;n({url:e.relativeUrl+"/metadata/grids.json",async:!1,success:function(e){for(var t=JSON.parse(e),n=[],o=0,a=t.grids.length;o<a;o++){var r=t.grids[o];r.start.X=r.start.x,r.start.Y=r.start.y,r.start.Z=r.start.z,r.end.X=r.end.x,r.end.Y=r.end.y,r.end.Z=r.end.z,n.push(r)}i.Grids=n}}),n({async:!1,url:e.relativeUrl+"/metadata/levels.json",success:function(e){i.Levels=JSON.parse(e).levels}}),n({async:!1,url:e.relativeUrl+"/resource/v3/maps/output.json",dataType:"text",success:function(t){var n=JSON.parse(t);for(var i in n){var a=n[i];void 0==a.id&&(a.id=i),a.path=e.relativeUrl+"/resource/v3/maps/"+a.id+".png",a.name=i,o.push(a)}}});var a=i.Levels;if(a)for(var r=0;r<a.length;r++)(function(e){var t=!1;return o.some(function(n){return t=n.id.toString()===e.toString()}),t})(a[r].id)||(a.splice(r,1),r--);return{axisGrid:i,floors:o}},getLevels:function(e,n){var i=n.relativeUrl+"/metadata/levels.json";return e&&(i=n.relativeUrl+"/metadata/"+e+"/levels.json"),t(i,"noCode")},getFloors:function(e){var n=e.relativeUrl+"/data/spaces.json";return t(n,"noCode")},getViews:function(e){var t={data:null,resourceHost:"./"};return n({url:e.relativeUrl+"/metadata/views.json",async:!1,success:function(e){t.data=e}}),t},getViewsById:function(e){var t={data:null,resourceHost:"./"};return n({url:e.relativeUrl+"/metadata/"+e.fileId+"/views.json",async:!1,success:function(e){t.data=e}}),t},getViewData:function(e){var n=e.relativeUrl+"/metadata/viewStates/"+e.viewId+".json";return t(n,"noCode")},getRooms:function(e){var n=e.resourceHost+"/"+e.databagId+"/metadata/rooms.json";return t(n,"noCode")},getRoomBoundary:function(e,n){var i=n.resourceHost+"/"+n.databagId+"/metadata/roomsboundary/"+e+".json";return t(i,"noCode")},getAllDrawingsheets:function(e){var n=e.relativeUrl+"/metadata/drawings.json";return t(n,"noCode")},decodeElementId:function(e,t){if(/^[0-9]*\.*[0-9]*$/.test(t))return Promise.resolve(t);var n=t.split("."),i=n[0];return this.getFiles(e).then(function(e){var t=!0,o=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var u=r.value,c=!0,l=!1,d=void 0;try{for(var f,h=u.linkedBy[Symbol.iterator]();!(c=(f=h.next()).done);c=!0){if(f.value==i)return u.fileId+"."+n[1]}}catch(e){l=!0,d=e}finally{try{!c&&h.return&&h.return()}finally{if(l)throw d}}}}catch(e){o=!0,a=e}finally{try{!t&&s.return&&s.return()}finally{if(o)throw a}}}).then(function(e){return e})},getCategoryVisibility:function(e){var n=e.relativeUrl+"/metadata/categoryVisibility.json";return t(n,"noCode")},getText:function(e){var n=e.relativeUrl+"/metadata/text.json";return t(n,"noCode")},getSegmentGroups:function(e){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentGroups?view_token="+e.viewToken;return t(n,"noCode")},getSegmentFromGroups:function(e,n){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentGroups/"+n+"/segments?view_token="+e.viewToken;return t(i,"noCode")},getSegmentTree:function(e){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentTree?view_token="+e.viewToken;return t(n,"noCode")},getSegmentById:function(e,n){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segments/"+n+"?view_token="+e.viewToken;return t(i,"noCode")},getSegmentElementIds:function(e,n){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segments/"+n+"/elementIds?view_token="+e.viewToken;return t(i,"noCode")},getPartialElementsMetadata:function(e,n){var i=e.relativeUrlWithoutDatabagId+"/"+n+"/metadata/partial_elements_metadata.json";return t(i,"noCode")},getPartialElementsMetadataFile:function(e,t){return e.relativeUrlWithoutDatabagId+"/"+t+"/metadata/partial_elements_metadata.json"},getDatabagResource:function(e,t){return e.relativeUrlWithoutDatabagId+"/"+t+"/resource/v3/model"},getModelGroup:function(e,n){var i=e.relativeUrl+"/metadata/modelSetsTree.json";return t(i,"noCode")},getManifest:function(e){var n=e.relativeUrl+"/manifest.json";return t(n,"noCode")},getNestedComponents:function(e){var n=e.relativeUrl+"/metadata/nestedComponents.json";return t(n,"noCode")},getWalkthrough:function(e){var n=e.relativeUrl+"/data_ext/walkthrough.json";return t(n,"noCode")},getProjectInfo:function(e){var n=e.relativeUrl+"/metadata/project.json";return t(n,"noCode")},getModelInfo:function(e){var n=e.relativeUrl+"/resource/v3/model/config.json";return t(n,"noCode")},getFeatureStyle:function(e){var n=e.relativeUrl+"/resource/v3/model/featureStyle.json";return t(n,"noCode")}};e.OfflineDataProdiver=i}(),function(){function e(e){this._config=e}var t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),n=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data.OfflineDataProdiver");e.prototype={getComponentProperty:function(e,t,i){var o=this;if(!e)return console.warn("elementId must not be empty!."),void(i&&i());var a=null;n.getObjectData(this._config,this).then(function(t){return a=t,n.decodeElementId(o._config,e)}).then(function(e){var n=a.getBoundingBox(e),i=a.getElementProperties(e),o={},r=!0,s=!1,u=void 0;try{for(var c,l=i[0].items[Symbol.iterator]();!(r=(c=l.next()).done);r=!0){var d=c.value;o[d.key]=d.value}}catch(e){s=!0,u=e}finally{try{!r&&l.return&&l.return()}finally{if(s)throw u}}t({boundingBox:n,elementId:o.ID,familyGuid:"",guid:o.GUID,name:o.familyType,properties:i})})},getMaterialProperty:function(e,t,i){var o=this;n.decodeElementId(o._config,e).then(function(e){n.getMaterialProperty(o._config,e).then(function(a){var r=e.split(".");r="singleModel"==o._config.modelType?r[0]:r[1];var s=[];if(a[r]){var u=!0,c=!1,l=void 0;try{for(var d,f=a[r][Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var h=d.value;s.push(n.getMaterialPropertyItem(o._config,e,h))}}catch(e){c=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw l}}Promise.all(s).then(function(e){t&&t(e)})}else i&&i(a)})})},getAreas:function(e,t){n.getAreas(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getMepSystem:function(e,t,i){var o=this;n.getMepSystem(e,o._config).then(function(e){t&&t(e,o._config.modelType)}).catch(function(e){i&&i(e)})},getTreeOldData:function(e,t){var i=this;n.getTreeOldData(i._config).then(function(t){e&&e(t,i._config.modelType,"old")}).catch(function(e){t&&t(e)})},getTreeNewData:function(e,t){var i=this;n.getTreeNewData(i._config).then(function(t){var n=!0;t&&t.length>0&&function e(t){"familyType"===t.type?t.items&&0!==t.items.length||(n=!1):t.items&&t.items.length>0&&e(t.items[0])}(t[0]),e&&e(t,i._config.modelType,n?void 0:"old")}).catch(function(e){t&&t(e)})},getRoomProperty:function(e,t,i){var o=this;n.getRoomProperty(e,this._config).then(function(i){var a="singleModel"==o._config.modelType?e:e.split("_")[1],r=!0,s=!1,u=void 0;try{for(var c,l=i[Symbol.iterator]();!(r=(c=l.next()).done);r=!0){var d=c.value;if(d.id==a)return void n.getObjectData(o._config,o).then(function(n){e="singleModel"==o._config.modelType?e:e.split("_")[0]+"."+e.split("_")[1];var i=n.getElementProperties(e);i.splice(0,1),d.properties=i,t&&t(d)})}}catch(e){s=!0,u=e}finally{try{!r&&l.return&&l.return()}finally{if(s)throw u}}})},getAreaProperty:function(e,t,i){var o=this;n.getAreaProperty(e,this._config).then(function(i){var a="singleModel"==o._config.modelType?e:e.split("_")[1],r=!0,s=!1,u=void 0;try{for(var c,l=i.areas[Symbol.iterator]();!(r=(c=l.next()).done);r=!0){var d=c.value;d.id==a&&n.getObjectData(o._config,o).then(function(n){e="singleModel"==o._config.modelType?e:e.split("_")[0]+"."+e.split("_")[1];var i=n.getElementProperties(e);i.splice(0,1),d.properties=i,t&&t(d)})}}catch(e){s=!0,u=e}finally{try{!r&&l.return&&l.return()}finally{if(s)throw u}}})},getModelGroup:function(e,t){n.getModelGroup(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getFiles:function(e,t){n.getFiles(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getLinkGraph:function(e,t){n.getFiles(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getDrawingsheets:function(e,t,i,o){var a=this;n.getDrawingsheets(this._config,e).then(function(e){i&&i(e,a._config.modelType,a._config.dataEnvType)})},getFloors:function(e,t){var i=this;n.getFloors(this._config).then(function(t){var n=!0,o=!1,a=void 0;try{for(var r,s=t.data[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var u=r.value;u.miniMap=i._config.databagId+"/resource/v3/maps/"+u.name+".png"}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}e&&e(t.data)})},getElementByConditions:function(e,t,i){var o=this;n.getObjectData(this._config,o).then(function(n){i&&i(n.getElementByConditions(e,t,o._config))})},getMapInfo:function(e){var t=n.getMapInfo(this._config);e&&e(t)},getLevels:function(e,t,i){n.getLevels(e,this._config).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getViews:function(e){var t=n.getViews(this._config);e&&e(t)},getViewsById:function(e,t){var i=this._config;i.fileId=e;var o=n.getViewsById(i);t&&t(o)},getViewData:function(e,t){var i=Object.assign({},this._config);i.viewId=e,n.getViewData(i).then(function(e){"[object Function]"===Object.prototype.toString.call(t)&&t(e)}).catch(function(e){"[object Function]"===Object.prototype.toString.call(failure)&&failure(e)})},getRooms:function(e,t){n.getRooms(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getRoomBoundary:function(e,t,i){n.getRoomBoundary(e,this._config).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getAllDrawingsheets:function(e,t,i,o){var a=this;n.getAllDrawingsheets(this._config).then(function(e){i&&i(e,a._config.modelType)}).catch(function(e){i&&i({drawingList:[]},a._config.modelType)})},getCategoryVisibility:function(e,t){n.getCategoryVisibility(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getText:function(e,t){n.getText(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentGroups:function(e,t){n.getSegmentGroups(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentFromGroups:function(e,t,i){n.getSegmentFromGroups(this._config,e).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getSegmentTree:function(e,t){n.getSegmentTree(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentById:function(e,t,i){n.getSegmentById(this._config,e).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getSegmentElementIds:function(e,t,i){n.getSegmentElementIds(this._config,e).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getPartialElementsMetadata:function(e,t,i){n.getPartialElementsMetadata(this._config,e).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getPartialElementsMetadataFile:function(e){return n.getPartialElementsMetadataFile(this._config,e)},getDatabagResource:function(e){return n.getDatabagResource(this._config,e)},getManifest:function(e,t){n.getManifest(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getNestedComponents:function(e,t){n.getNestedComponents(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getWalkthrough:function(e,t){n.getWalkthrough(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getProjectInfo:function(e,t){var i=this;n.getProjectInfo(i._config).then(function(t){e&&e(t,i._config.modelType)}).catch(function(e){t&&t(e)})},getModelInfo:function(e,t){n.getModelInfo(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getFeatureStyle:function(e,t){n.getFeatureStyle(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})}},t.OfflineDataManager=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=Glodon.Web.Lang.Utility.HttpRequest.promiseJSONRequest,n=Glodon.Web.Lang.Utility.HttpRequest.ajax,i={getMepSystem:function(e,n){if("integrateModel"==n.modelType)var i=n.resourceHost+"/"+n.databagId+"/metadata/"+e+"/mepsystem.json";else var i=n.resourceHost+"/"+n.databagId+"/metadata/mepsystem.json";return t(i,"noCode")},getTreeNewData:function(e){var n=e.resourceHost+"/"+e.databagId+"/data/tree.json";return t(n)},getTreeOldData:function(e){if("singleModel"==e.modelType)var n=e.APIHost+"/data/v2/files/"+e.modelId+"/tree?v=2.0&view_token="+e.viewToken;else var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/tree?view_token="+e.viewToken+"&treeType=specialty";return t(n)},getDrawingList:function(e){function n(n,i){var o=e.APIHost+"/data/v2/files/"+n+"/drawingsheets?elementId="+i+"&view_token="+e.viewToken;return t(o)}function i(n,i,o){var a=e.APIHost+"/data/v2/integrations/"+n+"/drawingsheets?fileIdHash="+i+"&elementId="+o+"&view_token="+e.viewToken;return t(a)}var e=e;return{fromSingleModel:n,fromIntegrateModel:i}},getAreas:function(e){if("singleModel"==e.modelType)var n=e.APIHost+"/data/v2/files/"+e.modelId+"/floors?includeRoom=true&includeArea=true&view_token="+e.viewToken;else var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/floors?includeRoom=true&includeArea=true&view_token="+e.viewToken;return t(n)},getRoomProperty:function(e,n){if("singleModel"==n.modelType)var i=n.APIHost+"/data/v2/files/"+n.modelId+"/rooms/"+e+"?view_token="+n.viewToken;else var i=n.APIHost+"/data/v2/integrations/"+n.modelId+"/rooms/"+e+"?view_token="+n.viewToken;return t(i)},getAreaProperty:function(e,n){if("singleModel"==n.modelType)var i=n.APIHost+"/data/v2/files/"+n.modelId+"/areas/"+e+"?view_token="+n.viewToken;else var i=n.APIHost+"/data/v2/integrations/"+n.modelId+"/areas/"+e+"?view_token="+n.viewToken;return t(i)},getObjectData:function(e,n){if("singleModel"==e.modelType)var i=e.APIHost+"/data/v2/files/"+e.modelId+"/elements/"+n+"?view_token="+e.viewToken;else if("integrateModel"==e.modelType){var o=n.split(".");if(1==o.length)var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/elements/"+n+"?view_token="+e.viewToken;else var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/files/"+o[0]+"/elements/"+o[1]+"?view_token="+e.viewToken}else var i=e.APIHost+"/data/v2/sections/"+e.modelId+"/elements/"+n+"?view_token="+e.viewToken;return t(i)},getFamilyData:function(e,n){var i=e.APIHost+"/data/v2/rfaFiles/"+e.modelId+"/familyTypes/"+n+"?view_token="+e.viewToken;return t(i)},getEditedObjectData:function(e,n){if("singleModel"==e.modelType)var i=e.APIHost+"/data/v2/files/"+e.modelId+"/elements/"+n+"?includeOverrides=true&view_token="+e.viewToken;else{var o=n.split(".");if(1==o.length)var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/elements/"+n+"?includeOverrides=true&view_token="+e.viewToken;else var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/files/"+o[0]+"/elements/"+o[1]+"?includeOverrides=true&view_token="+e.viewToken}return t(i)},getFiles:function(e){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/files?includeDrawingSheet=true&view_token="+e.viewToken;return t(n)},getMaterialOverride:function(e,n,i){n=void 0==n?i.viewToken:n,e=void 0==e?i.modelId:e;var o=i.APIHost+"/data/v2/materialoverridesets/"+e+"?materialFormat=FULL_INSTANCE_JSON&sort=true&view_token="+n+"&compact=true";return t(o)},getLinkGraph:function(e){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/linkGraph?view_token="+e.viewToken;return t(n)},getMaterialProperty:function(e,n){if(!n)return void(failure&&failure({}));var i=n.split(".");if("singleModel"==e.modelType)var o=e.APIHost+"/data/v2/files/"+e.modelId+"/elements/"+i[0]+"/materials?view_token="+e.viewToken;else if("integrateModel"==e.modelType)var o=e.APIHost+"/data/v2/integrations/"+e.modelId+"/files/"+i[0]+"/elements/"+i[1]+"/materials?view_token="+e.viewToken;else var o=e.APIHost+"/data/v2/sections/"+e.modelId+"/elements/"+n+"/materials?view_token="+e.viewToken;return t(o)},getDrawingsheets:function(e,n){
var i=e.APIHost+"/data/v2/files/"+n+"/drawingsheets?fileId="+n+"&view_token="+e.viewToken;return t(i)},getAllDrawingsheets:function(e,n){var i=e.resourceHost+"/"+(e.integrateDrawings&&e.integrateDrawings.databagId||e.databagId)+"/metadata/drawings.json";return t(i,"noCode")},getLinksJson:function(e,n){var i=e.resourceHost+"/"+e.databagId+"/metadata/links.json";return t(i,"noCode")},getFloors:function(e){if("singleModel"==e.modelType)var n=e.APIHost+"/data/v2/files/"+e.modelId+"/floors?view_token="+e.viewToken;else var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/floors?view_token="+e.viewToken;return t(n)},getElementByConditions:function(e,n,i){var o="";for(var a in i)o+="&"+a+"="+i[a];if("singleModel"==e.modelType)var r=e.APIHost+"/data/element/id?fileId="+n+o+"&view_token="+e.viewToken;else var r=e.APIHost+"/data/v2/integrations/"+n+"/elementIds?view_token="+e.viewToken+o;return t(r)},getComponentsByConditions:function(e,n,i,o,a){for(var r={targetIds:[String(n)],targetType:"integrateModel"===e.modelType?"integration":"file",query:{boolOr:[]}},s=0;s<i.length;s++){var u=i[s],c={boolAnd:[]};for(var l in u)c.boolAnd.push({match:_defineProperty({},"levelName"===l&&"floor"||l,u[l])});1==c.boolAnd.length&&c.boolAnd.push(c.boolAnd[0]),r.query.boolOr.push(c)}1==r.query.boolOr.length&&r.query.boolOr.push(r.query.boolOr[0]);var d=e.APIHost+"/data/v2/query/elementIds?view_token="+e.viewToken;return t({url:d,type:"post",data:JSON.stringify(r),headers:{"Content-Type":"application/json"}})},getMapInfo:function(e){var t=this,i=(t._opt,{}),o=[];t._helper;n({url:e.resourceHost+"/"+e.databagId+"/metadata/grids.json",async:!1,success:function(e){for(var t=JSON.parse(e),n=[],o=0,a=t.grids.length;o<a;o++){var r=t.grids[o];r.start.X=r.start.x,r.start.Y=r.start.y,r.start.Z=r.start.z,r.end.X=r.end.x,r.end.Y=r.end.y,r.end.Z=r.end.z,n.push(r)}i.Grids=n}}),n({async:!1,url:e.resourceHost+"/"+e.databagId+"/metadata/levels.json",success:function(e){i.Levels=JSON.parse(e).levels}}),n({async:!1,url:e.resourceHost+"/"+e.databagId+"/resource/model/maps/output.json",dataType:"text",success:function(t){var n=JSON.parse(t);for(var i in n){var a=n[i];void 0==a.id&&(a.id=i),a.path=e.resourceHost+"/"+e.databagId+"/resource/model/maps/"+a.id+".png",a.name=i,o.push(a)}}});var a=i.Levels;if(a)for(var r=0;r<a.length;r++)(function(e){var t=!1;return o.some(function(n){return t=n.id.toString()===e.toString()}),t})(a[r].id)||(a.splice(r,1),r--);return{axisGrid:i,floors:o}},getLevels:function(e,n){var i=n.resourceHost+"/"+n.databagId+"/metadata/levels.json";return e&&(i=n.resourceHost+"/"+n.databagId+"/metadata/"+e+"/levels.json"),t(i,"noCode")},getViews:function(e){var t={data:null,resourceHost:e.resourceHost};return n({url:e.resourceHost+"/"+e.databagId+"/metadata/views.json",async:!1,success:function(e){t.data=e}}),t},getViewsById:function(e){var t={data:null,resourceHost:e.resourceHost};return n({url:e.resourceHost+"/"+e.databagId+"/metadata/"+e.fileId+"/views.json",async:!1,success:function(e){t.data=e}}),t},getViewData:function(e){var n=e.resourceHost+"/"+e.databagId+"/metadata/viewStates/"+e.viewId+".json";return t(n,"noCode")},getRooms:function(e){var n=e.resourceHost+"/"+e.databagId+"/metadata/rooms.json";return t(n,"noCode")},getRoomBoundary:function(e,n){var i=n.resourceHost+"/"+n.databagId+"/metadata/roomsboundary/"+e+".json";return t(i,"noCode")},getCategoryVisibility:function(e){var n=e.resourceHost+"/"+e.databagId+"/metadata/categoryVisibility.json";return t(n,"noCode")},getText:function(e){var n=e.resourceHost+"/"+e.databagId+"/metadata/text.json";return t(n,"noCode")},getScheduleList:function(e){var n=e.resourceHost+"/"+e.databagId+"/metadata/schedule.json";return t(n,"noCode")},getScheduleById:function(e,n){var i=n.resourceHost+"/"+n.databagId+"/metadata/schedule/"+e+".txt";return t(i,"noCode")},getSegmentGroups:function(e){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentGroups?view_token="+e.viewToken;return t(n,"noCode")},getSegmentFromGroups:function(e,n){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentGroups/"+n+"/segments?view_token="+e.viewToken;return t(i,"noCode")},getSegmentTree:function(e){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentTree?view_token="+e.viewToken;return t(n,"noCode")},getSegmentById:function(e,n){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segments/"+n+"?view_token="+e.viewToken;return t(i,"noCode")},getSegmentElementIds:function(e,n){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segments/"+n+"/elementIds?view_token="+e.viewToken;return t(i,"noCode")},getPartialElementsMetadata:function(e,n){var i=e.resourceHost+"/"+n+"/metadata/partial_elements_metadata.json";return t(i,"noCode")},getPartialElementsMetadataFile:function(e,t){return e.resourceHost+"/"+t+"/metadata/partial_elements_metadata.json"},getDatabagResource:function(e,t){return e.resourceHost+"/"+t+"/resource/v3/model"},getModelGroup:function(e,n){var i=e.resourceHost+"/"+e.databagId+"/metadata/modelSetsTree.json";return t(i,"noCode")},getManifest:function(e){var n=e.resourceHost+"/"+e.databagId+"/manifest.json";return t(n,"noCode",!0)},getNestedComponents:function(e){var n=e.relativeUrl+"/metadata/nestedComponents.json";return t(n,"noCode")},getWalkthrough:function(e){var n=e.relativeUrl+"/data_ext/walkthrough.json";return t(n,"noCode")},getProjectInfo:function(e){var n=e.resourceHost+"/"+e.databagId+"/metadata/project.json";return t(n,"noCode")},getModelInfo:function(e){var n=e.relativeUrl+"/resource/v3/model/config.json";return t(n,"noCode")},getFeatureStyle:function(e){var n=e.relativeUrl+"/resource/v3/model/featureStyle.json";return t(n,"noCode")}};e.OnlineDataProdiver=i}(),function(){function e(e){this._config=e}var t,n=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data.OnlineDataProdiver");e.prototype=(t={getComponentProperty:function(e,t,n){if(!e)return console.warn("elementId must not be empty!."),void(n&&n());i.getObjectData(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getFamilyProperty:function(e,t,n){if(!e)return console.warn("familyTypeId must not be empty!."),void(n&&n());i.getFamilyData(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getComponentOverriddenProperty:function(e,t,n){if(!e)return console.warn("elementId must not be empty!."),void(n&&n());i.getEditedObjectData(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getMaterialProperty:function(e,t,n){i.getMaterialProperty(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getTreeOldData:function(e,t){var n=this;i.getTreeOldData(n._config).then(function(t){e&&e(t,n._config.modelType,"old")}).catch(function(e){t&&t(e)})},getTreeNewData:function(e,t){var n=this;i.getTreeNewData(n._config).then(function(t){e&&e(t,n._config.modelType)}).catch(function(e){t&&t(e)})},getMepSystem:function(e,t,n){var o=this;i.getMepSystem(e,o._config).then(function(e){t&&t(e,o._config.modelType)}).catch(function(e){n&&n(e)})},getAreas:function(e,t){i.getAreas(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getRoomProperty:function(e,t,n){i.getRoomProperty(e,this._config).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getDrawingList:function(e,t,n,o){var a=this._config.modelType;if("integrateModel"==a){var r=t.split(".")[0],s=t.split(".")[1];i.getDrawingList(this._config).fromIntegrateModel(e,r,s).then(function(e){n&&n(e)}).catch(function(e){o&&o(e)})}else"singleModel"==a&&i.getDrawingList(this._config).fromSingleModel(e,t).then(function(e){n&&n(e)}).catch(function(e){o&&o(e)})},getModelGroup:function(e,t){i.getModelGroup(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getAreaProperty:function(e,t,n){i.getAreaProperty(e,this._config).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getFiles:function(e,t){i.getFiles(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getMaterialOverride:function(e,t,n,o){i.getMaterialOverride(e,t,this._config).then(function(e){n&&n(e)}).catch(function(e){o&&o(e)})},getLinkGraph:function(e,t){i.getLinkGraph(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getDrawingsheets:function(e,t,n,o){var a=this;e=e||a._config.modelId,i.getDrawingsheets(this._config,e).then(function(e){n&&n(e,a._config.modelType)}).catch(function(e){o&&o(e)})},getAllDrawingsheets:function(e,t,n,o){var a=this;e=e||a._config.modelId,i.getAllDrawingsheets(this._config,e).then(function(e){n&&n(e,a._config.modelType)}).catch(function(e){o&&o(e)})},getLinksJson:function(e,t,n,o){var a=this;e=e||a._config.modelId,i.getLinksJson(this._config,e).then(function(e){n&&n(e,a._config.modelType)}).catch(function(e){o&&o(e)})},getFloors:function(e,t){i.getFloors(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getElementByConditions:function(e,t,n,o){i.getElementByConditions(this._config,e,t).then(function(e){n&&n(e)}).catch(function(e){o&&o(e)})},getComponentsByConditions:function(e,t,n,o){i.getComponentsByConditions(this._config,e,t).then(function(e){n&&n(e&&e[0].elementIds)}).catch(function(e){o&&o(e)})},getMapInfo:function(e){var t=i.getMapInfo(this._config);e&&e(t)},getLevels:function(e,t,n){i.getLevels(e,this._config).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getViews:function(e){var t=i.getViews(this._config);e&&e(t)},getViewsById:function(e,t){var n=this._config;n.fileId=e;var o=i.getViewsById(n);t&&t(o)},getViewData:function(e,t,n){var o=Object.assign({},this._config);o.viewId=e,i.getViewData(o).then(function(e){"[object Function]"===Object.prototype.toString.call(t)&&t(e)}).catch(function(e){"[object Function]"===Object.prototype.toString.call(n)&&n(e)})},getRooms:function(e,t){i.getRooms(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getRoomBoundary:function(e,t,n){i.getRoomBoundary(e,this._config).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getCategoryVisibility:function(e,t){i.getCategoryVisibility(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getText:function(e,t){i.getText(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getScheduleList:function(e,t){i.getScheduleList(this._config).then(function(t){e&&e(t.scheduleList)}).catch(function(e){t&&t(e)})},getScheduleById:function(e,t,n){i.getScheduleById(e,this._config).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getSegmentGroups:function(e,t){i.getSegmentGroups(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentFromGroups:function(e,t,n){i.getSegmentFromGroups(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getSegmentTree:function(e,t){i.getSegmentTree(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentById:function(e,t,n){i.getSegmentById(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getSegmentElementIds:function(e,t,n){i.getSegmentElementIds(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getPartialElementsMetadata:function(e,t,n){i.getPartialElementsMetadata(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getPartialElementsMetadataFile:function(e){return i.getPartialElementsMetadataFile(this._config,e)},getDatabagResource:function(e){return i.getDatabagResource(this._config,e)}},_defineProperty(t,"getDatabagResource",function(e){return i.getDatabagResource(this._config,e)}),_defineProperty(t,"getManifest",function(e,t){i.getManifest(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})}),_defineProperty(t,"getNestedComponents",function(e,t){i.getNestedComponents(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})}),_defineProperty(t,"getWalkthrough",function(e,t){i.getWalkthrough(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})}),_defineProperty(t,"getProjectInfo",function(e,t){var n=this;i.getProjectInfo(n._config).then(function(t){e&&e(t,n._config.modelType)}).catch(function(e){t&&t(e)})}),_defineProperty(t,"getModelInfo",function(e,t){i.getModelInfo(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})}),_defineProperty(t,"getFeatureStyle",function(e,t){i.getFeatureStyle(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})}),t),n.OnlineDataManager=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=(Glodon.Web.Lang.Utility.HttpRequest,function(t){if(this._config=t,this._objectData=null,this._cache={},"Local"==t.dataEnvType?this.dataManager=new e.OfflineDataManager(t):this.dataManager=new e.OnlineDataManager(t),!t.viewToken)return!1});t.prototype={getComponentProperty:function(e,t,n){this.dataManager.getComponentProperty(e,t,n)},getFamilyProperty:function(e,t,n){this.dataManager.getFamilyProperty(e,t,n)},getComponentOverriddenProperty:function(e,t,n){this.dataManager.getComponentOverriddenProperty(e,t,n)},getDrawingList:function(e,t,n,i){this.dataManager.getDrawingList(e,t,n,i)},getTreeOldData:function(e,t){this.dataManager.getTreeOldData(e,t)},getTreeNewData:function(e,t){this.dataManager.getTreeNewData(e,t)},getMepSystem:function(e,t,n){this.dataManager.getMepSystem(e,t,n)},getModeTree:function(e,t){console.warn("This function is deprecated. Please use getTreeOldData instead."),this.getTreeOldData(e,t)},getFloors:function(e,t){this.dataManager.getFloors(e,t)},getAreas:function(e,t){this.dataManager.getAreas(e,t)},getAreaProperty:function(e,t,n){this.dataManager.getAreaProperty(e,t,n)},getModelGroup:function(e,t){this.dataManager.getModelGroup(e,t)},getMaterialProperty:function(e,t,n){this.dataManager.getMaterialProperty(e,t,n)},getRoomProperty:function(e,t,n){this.dataManager.getRoomProperty(e,t,n)},getFiles:function(e,t){this.dataManager.getFiles(e,t)},getMaterialOverride:function(e,t,n,i){this.dataManager.getMaterialOverride(e,t,n,i)},getLinkGraph:function(e,t){this.dataManager.getLinkGraph(e,t)},getDrawingsheets:function(e,t,n,i){this.dataManager.getDrawingsheets(e,t,n,i)},getElementByConditions:function(e,t,n,i){this.dataManager.getElementByConditions(e,t,n,i)},getComponentsByConditions:function(e,t,n,i){this.dataManager.getComponentsByConditions(e,t,n,i)},getAllDrawingsheets:function(e,t,n,i){this.dataManager.getAllDrawingsheets(e,t,n,i)},getLinksJson:function(e,t,n,i){this.dataManager.getLinksJson(e,t,n,i)},getMapInfo:function(e){this.dataManager.getMapInfo(e)},getCategoryVisibility:function(e,t){this.dataManager.getCategoryVisibility(e,t)},getText:function(e,t){this.dataManager.getText(e,t)},getScheduleList:function(e,t){this.dataManager.getScheduleList(e,t)},getScheduleById:function(e,t,n){this.dataManager.getScheduleById(e,t,n)},getSegmentGroups:function(e,t){this.dataManager.getSegmentGroups(e,t)},getSegmentFromGroups:function(e,t,n){this.dataManager.getSegmentFromGroups(e,t,n)},getSegmentTree:function(e,t){this.dataManager.getSegmentTree(e,t)},getSegmentById:function(e,t,n){this.dataManager.getSegmentById(e,t,n)},getSegmentElementIds:function(e,t,n){this.dataManager.getSegmentElementIds(e,t,n)},getPartialElementsMetadata:function(e,t,n){this.dataManager.getPartialElementsMetadata(e,t,n)},getPartialElementsMetadataFile:function(e){return this.dataManager.getPartialElementsMetadataFile(e)},getDatabagResource:function(e){return this.dataManager.getDatabagResource(e)},getManifest:function(e,t){return this.dataManager.getManifest(e,t)},getNestedComponents:function(e){return this.dataManager.getNestedComponents(e)},getWalkthrough:function(e){return this.dataManager.getWalkthrough(e)},getViews:function(e){return this.dataManager.getViews(e)},getViewData:function(e,t,n){return this.dataManager.getViewData(e,t,n)},getProjectInfo:function(e,t){this.dataManager.getProjectInfo(e,t)},getModelInfo:function(e,t){return this.dataManager.getModelInfo(e,t)},getFeatureStyle:function(e,t){return this.dataManager.getFeatureStyle(e,t)}},e.MetaDataManager=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=function(){return{resourceHost:hostConfig.resourceHost,databagId:null}};e.FamilyDataManagerConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=Glodon.Web.Lang.Utility.HttpRequest,n=function(e){if(!e.databagId)return!1;this.__config=e};n.prototype.getFamilyTypes=function(e,n){var i=this.__config,o=void 0;o="Local"==i.dataEnvType?"./"+i.databagId+"/metadata/floorTree.json":i.resourceHost+"/"+i.databagId+"/metadata/familyInfo.json",t.ajax({url:o,success:function(t){for(var t=JSON.parse(t),n=t.Types||t.types,i=0,o=n.length;i<o;i++)n[i].id=n[i].Id||n[i].id,n[i].name=n[i].Name||n[i].name,delete n[i].Id,delete n[i].Name;e&&e(n)},failure:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=JSON.parse(e);n&&n(t)})})},e.FamilyDataManager=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=function(){return{resourceHost:hostConfig.staticHost}};e.IBLManagerConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=Glodon.Web.Lang.Utility.HttpRequest,n=function(e){this.__config=e};n.prototype.getIBLConfig=function(e,n){var i=this.__config,o=void 0;if("Local"==i.dataEnvType)return!1;o=i.resourceHost+"/resources/IBL/IBLConfig.json",t.ajax({url:o,success:function(t){var n=JSON.parse(t);e&&e(n)},failure:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=JSON.parse(e);n&&n(t)})})},e.IBLManager=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=(Glodon.Web.Lang.Utility.HttpRequest,t||{});t.version=1,t.EnumObjectTableIndex={OTI_OBJECTS_VALUES:0,OTI_PROPERTY_SCHEMAS:1,OTI_ELEMENT_PROPERTIES:2,OTI_FAMILY_PROPERTIES:3,OTI_FAMILIES:4,OTI_ELEMENTS:5,OTI_BOUNDING_BOX:6,OTI_ELEMENTS_CLASS:7};var n=function(e){this.url=e,this.objectsDB=[]};n.prototype={load:function(e){for(var t=this,n=["Values.json","Schemas.json","ElementProperties.json","FamilyTypeProperties.json","Families.json","Elements.json","BoundingBox.json"],i=n.length,o=0,a=n.length;o<a;++o)!function(o){(new THREE.FileLoader).load(t.url+"/"+n[o]+CLOUD.GlobalData.ZipResourcePostfix,function(n){t.objectsDB[o]=JSON.parse(n),0==(i-=1)&&e()})}(o)},getFamilyTypeProperties:function(e){var n=this.objectsDB[t.EnumObjectTableIndex.OTI_FAMILIES],i=n[e];if(void 0===i)return null;for(var o=this.objectsDB[t.EnumObjectTableIndex.OTI_OBJECTS_VALUES],a=this.objectsDB[t.EnumObjectTableIndex.OTI_FAMILY_PROPERTIES],r=this.objectsDB[t.EnumObjectTableIndex.OTI_PROPERTY_SCHEMAS],s=0,u=0,c=0,l={},d=[],f=0,h=0,g=i[2],v=i[1];h<g;++h){s=2*(v+h),u=4*a[s],c=a[s+1],f=r[u];var m=l[f];void 0===m&&(m=[],l[f]=m,d.push(f)),m.push({key:o[r[u+1]],unit:o[r[u+3]],valueType:r[u+2],value:o[c]})}for(var p=[],h=0,y=d.length;h<y;++h)f=d[h],p.push({group:o[f],items:l[f]});return p},getElementProperties:function(e){if(null==e)return null;var n=this.objectsDB[t.EnumObjectTableIndex.OTI_ELEMENTS],i=n[e];if(void 0===i)return null;for(var o=this.objectsDB[t.EnumObjectTableIndex.OTI_OBJECTS_VALUES],a=this.objectsDB[t.EnumObjectTableIndex.OTI_ELEMENT_PROPERTIES],r=this.objectsDB[t.EnumObjectTableIndex.OTI_PROPERTY_SCHEMAS],s=0,u=0,c=0,l={},d=[],f=0,h=0,g=i[2],v=i[1];h<g;++h){s=2*(v+h),u=4*a[s],c=a[s+1],f=r[u];var m=l[f];void 0===m&&(m=[],l[f]=m,d.push(f)),m.push({key:o[r[u+1]],unit:o[r[u+3]],valueType:r[u+2],value:o[c]})}for(var p=[],h=0,y=d.length;h<y;++h)f=d[h],p.push({group:o[f],items:l[f]});var w=this.getFamilyTypeProperties(i[3]);if(!w)return p;var b={},_=[];p=w.concat(p);var x=!0,I=!1,C=void 0;try{for(var M,T=p[Symbol.iterator]();!(x=(M=T.next()).done);x=!0){var S=M.value;if(b[S.group]){var P=[].concat.apply(b[S.group].items,S.items),k=[],E=!0,D=!1,L=void 0;try{for(var j,G=P[Symbol.iterator]();!(E=(j=G.next()).done);E=!0){var O=j.value,A=!0,N=!0,B=!1,U=void 0;try{for(var H,V=k[Symbol.iterator]();!(N=(H=V.next()).done);N=!0){var F=H.value;O.key==F.key&&(A=!1)}}catch(e){B=!0,U=e}finally{try{!N&&V.return&&V.return()}finally{if(B)throw U}}A&&k.push(O)}}catch(e){D=!0,L=e}finally{try{!E&&G.return&&G.return()}finally{if(D)throw L}}b[S.group]={group:b[S.group].group,items:k}}else b[S.group]=S}}catch(e){I=!0,C=e}finally{try{!x&&T.return&&T.return()}finally{if(I)throw C}}for(var S in b)"åŸºæœ¬å±žæ€§"==b[S].group?_.unshift(b[S]):_.push(b[S]);return _},getElementByConditions:function(e,n,i){var o=this.objectsDB[t.EnumObjectTableIndex.OTI_ELEMENTS_CLASS],a=Object.keys(n),r=[],s=[],u={},c={min:{x:null,y:null,z:null},max:{x:null,y:null,z:null}},l=[],d=!0,f=!1,h=void 0;try{for(var g,v=a[Symbol.iterator]();!(d=(g=v.next()).done);d=!0){var m=g.value;l.push({typeIndex:this._getGroupsKey(m,n[m],o),typeValue:n[m]})}}catch(e){f=!0,h=e}finally{try{!d&&v.return&&v.return()}finally{if(f)throw h}}for(var p=0;p<o.groups.length;p+=3){var y=!0,w=!0,b=!1,_=void 0;try{for(var x,I=l[Symbol.iterator]();!(w=(x=I.next()).done);w=!0){var C=x.value,M=o.groups[p][C.typeIndex];if(o.values[M]!=C.typeValue){y=!1;break}}}catch(e){b=!0,_=e}finally{try{!w&&I.return&&I.return()}finally{if(b)throw _}}if(y)if("singleModel"==i.modelType)r=r.concat(o.groups[p+1][""]);else{var T=o.groups[p+1],S=o.groups[p+2];for(var P in T){var k=!0,E=!1,D=void 0;try{for(var L,j=T[P][Symbol.iterator]();!(k=(L=j.next()).done);k=!0){var G=L.value;s.push({fileId:P,elementId:G})}}catch(e){E=!0,D=e}finally{try{!k&&j.return&&j.return()}finally{if(E)throw D}}}(c.min.x>S[0]||null==c.min.x)&&(c.min.x=S[0]),(c.min.y>S[1]||null==c.min.y)&&(c.min.y=S[1]),(c.min.z>S[2]||null==c.min.z)&&(c.min.z=S[2]),(c.max.x<S[3]||null==c.max.x)&&(c.max.x=S[3]),(c.max.y<S[4]||null==c.max.y)&&(c.max.y=S[4]),(c.max.z<S[5]||null==c.max.z)&&(c.max.z=S[5])}}return"singleModel"==i.modelType?r:0==s.length?[]:(u.elements=s,u.boundingBox=c,u)},_getGroupsKey:function(e,t,n){for(var i=0,o=0;o<n.keys.length;o++)if(n.keys[o]==e){i=o;break}return i},getBoundingBox:function(e){if(null==e)return null;var n=this.objectsDB[t.EnumObjectTableIndex.OTI_BOUNDING_BOX],i="";try{i={min:{x:n[e][0],y:n[e][1],z:n[e][2]},max:{x:n[e][3],y:n[e][4],z:n[e][5]}}}catch(e){console.log("no boundingBox Data"),i=""}return i}},e.ObjectPropertyManager=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=function(){return{APIHost:hostConfig.APIHost,resourceHost:hostConfig.resourceHost,viewToken:null,modelId:null,modelType:"singleModel",dataEnvType:hostConfig.dataEnvType||"BIMFACE"}};e.FileManagerConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=Glodon.Web.Lang.Utility.HttpRequest,n=function(e){this.__config=e};n.prototype.getViewToken=function(e,n,i){var o=this.__config,a=void 0;return"singleModel"!=o.modelType&&("Local"==o.dataEnvType?void(n&&n()):(a=o.APIHost+"/data/v2/integrations/"+o.modelId+"/files/"+e+"/viewToken?view_token="+o.viewToken,void t.ajax({url:a,type:"post",success:function(e){var t=JSON.parse(e);n&&n(t.data)},failure:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=JSON.parse(e);i&&i(t)})})))},e.FileManager=n}();var CLOUD$1=window.CLOUD=window.CLOUD||{};!function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer"),t=function e(){_classCallCheck(this,e);var t={domElement:null,resourceHost:hostConfig.resourceHost,staticHost:hostConfig.staticHost+"/api/Glodon",APIHost:hostConfig.APIHost,sdkUrl:null,staticPath:"/api/Glodon"};for(var n in t)this[n]=t[n]};e.ViewerPDFConfig=t}(),function(){var e=Object.freeze({ViewLoaded:"ViewLoaded",ViewLoading:"ViewLoading",ViewMoved:"ViewMoved",ViewZoomed:"ViewZoomed"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer").ViewerPDFEvent=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),n=Glodon.Web.Lang.Utility.ClientHelper.isWebGLAvailable(),i=(Object.freeze({TranslucentOthers:"",HideOthers:""}),function(){var e=new Glodon.Web.Lang.EventManager;this.viewerType="Viewer",this.getEventManager=function(){return e}});i.prototype.destroy=function(){this.getEventManager=null},i.prototype.init=function(){},i.prototype.getViewerType=function(e){return this.viewerType},i.prototype.addView=function(e,t,i){if(n){var o=this,a=Glodon.Bimface.Authentication.AuthenticationManager,r=(o._opt,new Glodon.Bimface.Authentication.AuthenticationConfig);r.viewToken=e,r.APIHost=this._opt.APIHost,r.enableStorage=this.enableStorage;(this.authenticate=new a(r)).authenticate(function(e){"bimView"==e.renderType&&("pdf-transfer"!==e.workerType?e.renderType="3DView":e.renderType="pdfView"),o.loadViewCore(e,t,i)},function(e){var t=Glodon.Bimface.Viewer.Viewer3DEvent;o.getEventManager().fireEvent(t.Error,e)})}},i.prototype.loadViewCore=function(){},i.prototype.addEventListener=function(e,t){this.getEventManager().addEvent(e,t)},i.prototype.removeEventListener=function(e,t){this.getEventManager().removeEvent(e,t)},i.prototype.enableFullScreen=function(e){var t=this._opt.domElement,n=this;e?Glodon.Web.Lang.Utility.FullScreen.fullScreen(t):Glodon.Web.Lang.Utility.FullScreen.exitFullScreen(),setTimeout(function(){n.resize()},200)},i.prototype._loadNotSuportPromptPage=function(e){var n=t.create("div","bf-waring-container"),i=t.create("div","bf-waring"),o=t.create("span","bf-waring-icon"),a=t.create("span","bf-waring-text");a.innerText=BimfaceLanguage.bf_browser_notSupported,i.appendChild(o),i.appendChild(a),n.appendChild(i);var r=t.create("div","bf-suggestion");r.innerText=BimfaceLanguage.bf_browser_suggestion,n.appendChild(r);var s=t.create("div","bf-logo");n.appendChild(s),e.appendChild(n)},e.Viewer=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),n=function(n){function i(e){_classCallCheck(this,i);var t=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return t._cloudViewer=CLOUD$1.PdfCore,t._opt=e,t._domElement=e.domElement,t._views={},t.setWorkerUrl(),t.setCMapUrl(),t}return _inherits(i,n),_createClass(i,[{key:"setWorkerUrl",value:function(){this._cloudViewer.setWorkerUrl(window.BimfaceLoaderConfig.fullStaticHost+"/bimface.pdf.worker.js")}},{key:"setCMapUrl",value:function(){this._cloudViewer.setCMapUrl(window.BimfaceLoaderConfig.fullStaticHost+"/cmaps/")}},{key:"loadViewCore",value:function(e,t,n){this._data=e,this._pdfName=e.name,this._loadPdf()}},{key:"_loadPdf",value:function(){var n=this;this._getManifest(function(i){n._pdfFileName=i.Metadata.Name;var o=new CLOUD$1.PdfCore.ViewConfig;o.domElement=n._domElement,o.pdfUrl=n._getPdfUrl();var a=CLOUD$1.PdfCore.addView(o);n._views[a]=CLOUD$1.PdfCore.views[a];var r=t.create("div","bf-loading");r.style.zIndex=100;var s=t.create("div","bf-loading-gif"),u=t.create("div","bf-loading-progress");u.innerText="0%",r.appendChild(s),r.appendChild(u);var c=n._domElement.querySelector(".bf-pdf-outer");c.appendChild(r),n._views[a].eventBus.on(CLOUD$1.PdfCore.ViewEvent.ViewLoading,function(t){n.getEventManager().fireEvent(e.ViewerPDFEvent.ViewLoading),u.innerText=t}),n._views[a].eventBus.on(CLOUD$1.PdfCore.ViewEvent.ViewLoaded,function(){n.getEventManager().fireEvent(e.ViewerPDFEvent.ViewLoaded),c.removeChild(r)}),n._views[a].eventBus.on(CLOUD$1.PdfCore.ViewEvent.ViewMoved,function(t){n.getEventManager().fireEvent(e.ViewerPDFEvent.ViewMoved,t)}),n._views[a].eventBus.on(CLOUD$1.PdfCore.ViewEvent.ViewZoomed,function(t){n.getEventManager().fireEvent(e.ViewerPDFEvent.ViewZoomed,t)}),void 0===n._defaultViewId&&(n._defaultViewId=a),void 0===n._view&&(n._view=n._views[n._defaultViewId])})}},{key:"_getPdfUrl",value:function(){var e=this._getMetaDataManager(),t=e._config.resourceHost,n=this._data.databagId;return this._pdfUrl=t+"/"+n+"/"+this._manifest.Metadata.Path+"/"+this._pdfFileName,this._pdfUrl}},{key:"_getManifest",value:function(e){var t=this;if(this._manifest)return void("[object Function]"===Object.prototype.toString.call(e)&&e(this._manifest));this._getMetaDataManager().getManifest(function(n){t._manifest=n,"[object Function]"===Object.prototype.toString.call(e)&&e(t._manifest)})}},{key:"_getMetaDataManager",value:function(){if(this._metaDataManager)return this._metaDataManager;var e=new Glodon.Bimface.Data.MetaDataManagerConfig;e.viewToken=this._data.viewToken,e.databagId=this._data.databagId,e.resourceHost=this._opt.resourceHost,e.APIHost=this._opt.APIHost;var t=new Glodon.Bimface.Data.MetaDataManager(e);return this._metaDataManager=t,t}},{key:"getViewer",value:function(){return this._cloudViewer}},{key:"getView",value:function(e){return void 0===e&&(e=this._defaultViewId),this._views[e]}},{key:"getDomElement",value:function(){return this._domElement}},{key:"getPageCount",value:function(){return this._view.numPages}},{key:"getCurrentPageNo",value:function(){return this._view.currentPageNo}},{key:"destroy",value:function(){for(var e in this._views)this._cloudViewer.removeView(e);this._views={},delete this._data,delete this._pdfName,delete this._pdfFileName,delete this._view,delete this._defaultViewId,delete this._pdfUrl,delete this._metaDataManager,delete this._manifest}},{key:"load",value:function(e){this.addView(e)}},{key:"setDragMode",value:function(e){this.getView(e).setDragMode()}},{key:"setTextMode",value:function(e){this.getView(e).setTextMode()}},{key:"zoomIn",value:function(e){this.getView(e).viewZoom.zoomIn()}},{key:"zoomOut",value:function(e){this.getView(e).viewZoom.zoomOut()}},{key:"setZoom",value:function(e,t){e=e||1,this.getView(t).viewZoom.setZoom(e)}},{key:"nextPage",value:function(e){this.getView(e).viewPageTurning.nextPage()}},{key:"previousPage",value:function(e){this.getView(e).viewPageTurning.previousPage()}},{key:"turnToPage",value:function(e,t){e=e||1,this.getView(t).viewPageTurning.turnTo(e)}},{key:"fullScreen",value:function(e){this.getView(e).viewFullScreen.fullScreen()}},{key:"exitFullScreen",value:function(e){this.getView(e).viewFullScreen.exit()}}]),i}(e.Viewer);e.ViewerPDF=n}(),window.Glodon=Glodon;